<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>x-admin</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="/static/xadmin/lib/layui/css/layui.css" media="all">
</head>
<body>
<div class="layui-card">
    <div class="layui-card-body">
        <!--主体内容 start-->
        <div class="layui-row">

            <div class="layui-col-md3">
                <input type="text" id="ser_row" name="ser_row" required  lay-verify="required" placeholder="名称" autocomplete="off" class="layui-input">
            </div>

            <div class="layui-col-md1">
                <button style="margin-left: 50px;" class="layui-btn" onclick="ser_on()">搜索</button>
            </div>
            <div class="layui-col-md1">
                <button style="margin-left: 50px;" class="layui-btn layui-btn-danger"  onclick="set_all_del()">批量删除</button>
            </div>
        </div>
        <table id="demo" lay-filter="test">

        </table>


        <!--主体内容 end-->
    </div>
</div>
<script src="/static/xadmin/lib/layui/jquery-3.2.1.min.js"></script>
<script src="/static/xadmin/lib/layui/layui.js"></script>
<script>
    layui.config({
        base: '/static/xadmin/' //静态资源所在路径
    });
    layui.use(['laydate','form'], function(){
        var laydate = layui.laydate;
        var table = layui.table;
        var form = layui.form;
    });
    var TABLE='';
    layui.use('table', function(){
        var table = layui.table;
        TABLE=table;
        var urls = '{:url("/admin/system/log")}';
        //第一个实例
        TB = table.render({
            elem: '#demo'
            ,height: 'full-100'
            ,limits:[100,500]
            ,limit:100
            ,url: urls //数据接口
            ,page: true //开启分页
            ,toolbar: true//开启筛选图标 导出图标   打印图标
            ,cols: [[ //表头
                { type: 'checkbox',width:100}
                ,{field: 'id', title: 'ID',  sort: true}
                ,{field: 'admin_name', title: '操作用户',  sort: true}
                ,{field: 'description', title: '描述',  sort: true,}
                ,{field: 'type', title: '日志类型', sort: true,templet: function(d) {
                    if(d.type == 1) {
                        return '正确';
                    } else if(d.type == 0) {
                        return '错误';
                    }
                }}
                ,{field: 'ip', title: 'ip',  sort: true,}
                ,{field: 'create_time', title: '操作时间',  sort: true,}
                ,{field: '#', title: '操作',toolbar: '#barDemo'}
            ]]
        });
    });
    //搜索
    function ser_on(){
        var ser_row = $("#ser_row").val();
        var urls = '{:url("admin/system/log")}'+'?keyword='+ser_row;
        TB.reload({
            url: urls
            ,cols: [[ //表头
                { type: 'checkbox',width:100}
                ,{field: 'id', title: 'ID',  sort: true}
                ,{field: 'admin_name', title: '操作用户',  sort: true}
                ,{field: 'description', title: '描述',  sort: true,}
                ,{field: 'type', title: '日志类型', sort: true,templet: function(d) {
                    if(d.type == 1) {
                        return '正确';
                    } else if(d.type == 0) {
                        return '错误';
                    }
                }}
                ,{field: 'ip', title: 'ip',  sort: true,}
                ,{field: 'create_time', title: '操作时间',  sort: true,}
                ,{field: '#', title: '操作',toolbar: '#barDemo'}
            ]]
        });
    }

    /*
    删除
     */
    function set_del(t) {
        var id=$(t).attr("id-data");
        layer.confirm('你确定要删除么？', {
            btn: ['确定', '取消'] //可以无限个按钮
        }, function(index, layero){
            //按钮【按钮一】的回调
            $.post('{:url("admin/system/log_del")}',{'id':id},function(data){
                if(data.code==1){
                    layer.msg(data.msg,{icon:1});
                    setTimeout(function () {
                        location.reload();
                    },1500);

                }else{
                    layer.alert(data.msg,{icon:2});
                }
            });

        }, function(index){
            //按钮【按钮二】的回调
        });
        
    }

    /*
    批量删除
    */
    function set_all_del() {
        var checkStatus=TABLE.checkStatus("demo");  //        <table id="demo" lay-filter="test"></table>
        var list=checkStatus.data;
        var ids=[];
        for(var i=0;i<list.length;i++){
            ids.push(list[i]["id"]);
        }
        if(ids==""){
            layer.msg("请勾选要删除",{iocn:2});
            return 0;
        }
        layer.confirm('你确定要删除么？', {
            btn: ['确定', '取消'] //可以无限个按钮
        }, function(index, layero){
            //按钮【按钮一】的回调
            $.post('{:url("admin/system/log_del")}',{'ids':ids},function(data){
                if(data.code==1){
                    layer.msg(data.msg,{icon:1});
                    setTimeout(function () {
                        location.reload();
                    },1500);

                }else{
                    layer.alert(data.msg,{icon:2});
                }
            });

        }, function(index){
            //按钮【按钮二】的回调
        });
    }

</script>
</body>
</html>

<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-danger layui-btn-xs "  id-data="{{d.id}}" onclick="set_del(this)">删除</a>
</script>
