<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>x-admin</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="__STATIC1__/xadmin/lib/layui/css/layui.css" media="all">
    <script>
        /^http(s*):\/\//.test(location.href) || alert('请先部署到 localhost 下再访问');
    </script>
    <style type="text/css">
        .hide {
            display: none
        }
    </style>
</head>

<body class="layui-layout-body">
    <blockquote class="layui-elem-quote rule_top">

        <div class="layui-inline">
            <a id="add_rule" class="layui-btn layui-btn-normal"><i class="layui-icon">&#xe654;</i> 新增根菜单</a>
        </div>
    </blockquote>
    <fieldset class="layui-elem-field layui-field-title">
        <legend style="font-size: 14px;">分类列表</legend>
    </fieldset>

    <div class="layui-container" style=" width: 100%; height: 780px;">

        <div class="layui-row">
            <div class="layui-col-md3"
                style="overflow-y: scroll; height: 600px; border-right: 2px solid #eee; margin: 5px 0">
                <ul id="demo" style="padding: 5px 10px;"></ul>
            </div>
            <div class="layui-col-md9" style="padding: 0 10px;">
                <table class="layui-table">
                    <thead>
                        <tr>
                            <th>菜单名称</th>
                            <th>菜单权限</th>
                            <th>类型</th>
                            <th>排序</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody class="select_rule">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script src="__STATIC1__/xadmin/lib/layui/jquery-3.2.1.min.js"></script>
    <script src="__STATIC1__/xadmin/lib/layui/layui.js"></script>
    <script>
        var res = { $res| raw};
        layui.config({
            base: '__STATIC1__/xadmin/' //静态资源所在路径
        });
        layui.use(['tree', 'form', 'layer'], function () {
            var $ = layui.jquery,
                layer = layui.layer,
                form = layui.form;
            var html = "";
            layui.tree({
                elem: '#demo' //指定元素
                , skin: 'yellow'
                , target: '_self' //是否新选项卡打开（比如节点返回href才有效）
                , click: function (item) {
                    var typename = '';
                    if (item.type == "1") {
                        typename = "菜单栏控制"
                    } else {
                        typename = "节点控制"
                    }
                    var statusName = '';
                    if (item.status == 1) {
                        statusName = '显示';
                    } else {
                        statusName = '隐藏';
                    }

                    $('.select_rule').html('');
                    html = '<tr><td>' + item.name + '</td> ' +
                        '<td>' + item.href_name + '</td> ' +
                        '<td>' + typename + '</td> ' +
                        '<td>' + item.sort + '</td>' +
                        '<td>' + statusName + '</td> ' +
                        '<td> <a class="layui-btn layui-btn-mini add_child_rule"  data-id="' + item.id + '">添加子菜单</a> ' +
                        '<a class="layui-btn layui-btn-normal layui-btn-mini edit_rule" data-id="' + item.id + '">修改</a> ' +
                        '<a class="layui-btn layui-btn-danger layui-btn-mini del_rule" data-id="' + item.id + '">删除</a> ' +
                        '</td> ' +
                        '</tr>';
                    $('.select_rule').html(html);
                    //点击节点回调
                    // layer.alert('当前节名称：'+ item.name + '<br>全部参数：'+ JSON.stringify(item));
                    console.log(item);
                },

                nodes: res
            });

            //添加父菜单
            $('#add_rule').on('click', function () {
                var url = '{:url("index/authmenu/add")}';
                layer.open({
                    title: '新增根菜单',
                    type: 2,
                    content: url,
                    area: ['80%', '80%']
                });
            });
            //添加字菜单
            $("body").on("click", ".add_child_rule", function () {
                var id = $(this).attr("data-id");
                var url = '{:url("index/authmenu/add")}' + '?id=' + id;;
                layer.open({
                    title: '添加子菜单',
                    type: 2,
                    content: url,
                    area: ['80%', '80%']
                });
            })



            //修改菜单
            $("body").on("click", ".edit_rule", function () {
                var id = $(this).attr("data-id");
                var url = '{:url("index/authmenu/edit")}' + '?id=' + id;;
                layer.open({
                    title: '编辑菜单',
                    type: 2,
                    content: url,
                    area: ['80%', '80%']
                });
            });

            //删除菜单
            $("body").on("click", ".del_rule", function () {
                var id = $(this).attr("data-id");
                layer.confirm('是否删除该菜单？', {
                    icon: 2,
                    btn: ['确定', '取消'] //按钮
                }, function () {
                    $.post("{:url('index/authmenu/del')}", { 'id': id }, function (res) {
                        if (res.code == 1) {
                            layer.msg(res.msg, {
                                icon: 1
                            }, function () {
                                location.reload();
                            });
                        } else {
                            layer.msg(res.msg, {
                                icon: 2
                            });
                        }
                    })
                }, function () {
                    layer.msg('您取消了', {
                        icon: 1,
                        time: 1000
                    });
                });
            });


        });

    </script>
</body>

</html>